#failed
execute if entity @e[tag=sr_MapCenter,scores={sr_ingame=1,sr_timer=1}] run function scatter_respawn:stop

#success
execute if entity @e[tag=sr_MapCenter,scores={sr_ingame=1}] run execute store result score @e[tag=sr_MapCenter] sr_together run execute at @r run execute if entity @a[tag=!sr_observer,distance=..10]
execute if entity @e[tag=sr_MapCenter,scores={sr_ingame=1}] run execute store result score @e[tag=sr_MapCenter] sr_people run execute if entity @a[tag=!sr_observer]
execute if entity @e[tag=sr_MapCenter,scores={sr_ingame=1}] run scoreboard players operation @e[tag=sr_MapCenter] sr_people -= @e[tag=sr_MapCenter] sr_together
execute if entity @e[tag=sr_MapCenter,scores={sr_ingame=1,sr_people=0}] run function scatter_respawn:success

#timer
execute if entity @e[tag=sr_MapCenter,scores={sr_ingame=1}] run scoreboard players operation @e[tag=sr_MapCenter] sr_timerT = @e[tag=sr_MapCenter,limit=1] sr_timer
execute if entity @e[tag=sr_MapCenter,scores={sr_ingame=1}] run scoreboard players operation @e[tag=sr_MapCenter] sr_timerT /= @e[tag=sr_MapCenter,limit=1] sr_timer20
execute if entity @e[tag=sr_MapCenter,scores={sr_ingame=1}] run scoreboard players operation @e[tag=sr_MapCenter] sr_timerM = @e[tag=sr_MapCenter,limit=1] sr_timerT
execute if entity @e[tag=sr_MapCenter,scores={sr_ingame=1}] run scoreboard players operation @e[tag=sr_MapCenter] sr_timerS = @e[tag=sr_MapCenter,limit=1] sr_timerT
execute if entity @e[tag=sr_MapCenter,scores={sr_ingame=1}] run scoreboard players operation @e[tag=sr_MapCenter] sr_timerM /= @e[tag=sr_MapCenter,limit=1] sr_timer60
execute if entity @e[tag=sr_MapCenter,scores={sr_ingame=1}] run scoreboard players operation @e[tag=sr_MapCenter] sr_timerS %= @e[tag=sr_MapCenter,limit=1] sr_timer60
execute if entity @e[tag=sr_MapCenter,scores={sr_ingame=1}] run title @a actionbar ["",{"score":{"name":"@e[tag=sr_MapCenter]","objective":"sr_timerM"}},{"text":" m "},{"score":{"name":"@e[tag=sr_MapCenter]","objective":"sr_timerS"}},{"text":" s left"}]
execute if entity @e[tag=sr_MapCenter,scores={sr_ingame=1}] run scoreboard players remove @e[tag=sr_MapCenter] sr_timer 1

#range
execute if entity @e[tag=sr_MapCenter,scores={sr_ingame=1}] run tag @a remove sr_withinrange
execute if entity @e[tag=sr_MapCenter,scores={sr_ingame=1}] run execute at @e[tag=sr_MapCenter] run execute positioned ~-1024 -64 ~-1024 run tag @a[dx=2048,dy=400,dz=2048,tag=!sr_observer] add sr_withinrange

#iswithinrange(easy)
execute if entity @e[tag=sr_MapCenter,scores={sr_ingame=1,sr_timer=48000}] run execute unless entity @e[tag=sr_MapCenter,scores={sr_difficulty=1..}] run tellraw @a ["",{"text":"\u30de\u30c3\u30d7\u5916 : "},{"selector":"@a[tag=!sr_withinrange,tag=!sr_observer]"}]
execute if entity @e[tag=sr_MapCenter,scores={sr_ingame=1,sr_timer=24000}] run execute unless entity @e[tag=sr_MapCenter,scores={sr_difficulty=1..}] run tellraw @a ["",{"text":"\u30de\u30c3\u30d7\u5916 : "},{"selector":"@a[tag=!sr_withinrange,tag=!sr_observer]"}]
execute if entity @e[tag=sr_MapCenter,scores={sr_ingame=1,sr_timer=12000}] run execute unless entity @e[tag=sr_MapCenter,scores={sr_difficulty=1..}] run tellraw @a ["",{"text":"\u30de\u30c3\u30d7\u5916 : "},{"selector":"@a[tag=!sr_withinrange,tag=!sr_observer]"}]

#iswithinrange(normal)
execute if entity @e[tag=sr_MapCenter,scores={sr_ingame=1,sr_timer=36000,sr_difficulty=1}] run tellraw @a ["",{"text":"\u30de\u30c3\u30d7\u5916 : "},{"selector":"@a[tag=!sr_withinrange,tag=!sr_observer]"}]

#difficulty_config
execute if entity @e[tag=sr_easy] run tellraw @a "難易度がeasyに設定されました"
execute if entity @e[tag=sr_easy] run scoreboard players reset @e[tag=sr_MapCenter] sr_difficulty
execute if entity @e[tag=sr_easy] run tag @e[tag=sr_easy] remove sr_easy

execute if entity @e[tag=sr_normal] run tellraw @a "難易度がnormalに設定されました"
execute if entity @e[tag=sr_normal] run scoreboard players set @e[tag=sr_MapCenter] sr_difficulty 1
execute if entity @e[tag=sr_normal] run tag @e[tag=sr_normal] remove sr_normal

execute if entity @e[tag=sr_hard] run tellraw @a "難易度がhardに設定されました"
execute if entity @e[tag=sr_hard] run scoreboard players set @e[tag=sr_MapCenter] sr_difficulty 2
execute if entity @e[tag=sr_hard] run tag @e[tag=sr_hard] remove sr_hard

#observer_setting
execute if entity @a[tag=sr_observer_setting,tag=!sr_observer] run tag @a[tag=sr_observer_setting] add sr_observer_temp
execute if entity @a[tag=sr_observer_setting,tag=sr_observer] run tag @a[tag=sr_observer_setting] remove sr_observer
execute if entity @a[tag=sr_observer_setting] run tag @a[tag=sr_observer_temp] add sr_observer
execute if entity @a[tag=sr_observer_setting] run function scatter_respawn:book_reload
execute if entity @a[tag=sr_observer_setting] run execute if entity @a[tag=sr_observer_temp] run tellraw @a ["",{"text":""},{"selector":"@a[tag=sr_observer_setting]"},{"text":"を観戦者に設定しました"}]
execute if entity @a[tag=sr_observer_setting] run execute unless entity @a[tag=sr_observer_temp] run tellraw @a ["",{"text":""},{"selector":"@a[tag=sr_observer_setting]"},{"text":"を観戦者から除外しました"}]
execute if entity @a[tag=sr_observer_setting] run tag @a[tag=sr_observer_temp] remove sr_observer_temp
execute if entity @a[tag=sr_observer_setting] run tag @a[tag=sr_observer_setting] remove sr_observer_setting

#bossbar
execute if entity @e[tag=sr_MapCenter,scores={sr_ingame=1}] run execute store result bossbar display_timer value run scoreboard players get @e[tag=sr_MapCenter,limit=1] sr_timerT

#pos
execute if entity @e[tag=sr_MapCenter,scores={sr_ingame=1}] run execute at @a run execute store result score @p sr_posx run data get entity @p Pos[0]
execute if entity @e[tag=sr_MapCenter,scores={sr_ingame=1}] run execute at @a run execute store result score @p sr_posy run data get entity @p Pos[1]
execute if entity @e[tag=sr_MapCenter,scores={sr_ingame=1}] run execute at @a run execute store result score @p sr_posz run data get entity @p Pos[2]
execute if entity @e[tag=sr_MapCenter,scores={sr_ingame=1}] run execute at @a run scoreboard players operation @p sr_posx -= @e[tag=sr_MapCenter,limit=1] sr_posx
execute if entity @e[tag=sr_MapCenter,scores={sr_ingame=1}] run execute at @a run scoreboard players operation @p sr_posz -= @e[tag=sr_MapCenter,limit=1] sr_posz
execute if entity @e[tag=sr_MapCenter,scores={sr_ingame=1}] run execute at @a[tag=sr_observer] run title @p actionbar ["",{"text":"\u5ea7\u6a19: x "},{"score":{"name":"@p","objective":"sr_posx"}},{"text":" y "},{"score":{"name":"@p","objective":"sr_posy"}},{"text":" z "},{"score":{"name":"@p","objective":"sr_posz"}}]

#upper_setting
execute if entity @e[tag=sr_MapCenter,scores={sr_ingame=1}] run execute at @a[tag=sr_observer,tag=!sr_upper,x_rotation=-90.0] run tag @p add sr_upper_temp
execute if entity @e[tag=sr_MapCenter,scores={sr_ingame=1}] run execute at @a[tag=sr_observer,tag=sr_upper_temp] run tellraw @p ["",{"text":"-------------------------------------\n\u5404\u30d7\u30ec\u30a4\u30e4\u30fc\u306e\u5ea7\u6a19\n"},{"text":"[","clickEvent":{"action":"run_command","value":"/tp @p @e[tag=sr_SpawnMarker,scores={sr_player=1},limit=1]"}},{"selector":"@a[scores={sr_player=1}]","clickEvent":{"action":"run_command","value":"/tp @p @e[tag=sr_SpawnMarker,scores={sr_player=1},limit=1]"}},{"text":"]","clickEvent":{"action":"run_command","value":"/tp @p @e[tag=sr_SpawnMarker,scores={sr_player=1},limit=1]"}},{"text":" : "},{"score":{"name":"@a[scores={sr_player=1}]","objective":"sr_posx"}},{"text":" "},{"score":{"name":"@a[scores={sr_player=1}]","objective":"sr_posy"}},{"text":" "},{"score":{"name":"@a[scores={sr_player=1}]","objective":"sr_posz"}},{"text":"\n"},{"text":"[","clickEvent":{"action":"run_command","value":"/tp @p @e[tag=sr_SpawnMarker,scores={sr_player=2},limit=1]"}},{"selector":"@a[scores={sr_player=2}]","clickEvent":{"action":"run_command","value":"/tp @p @e[tag=sr_SpawnMarker,scores={sr_player=2},limit=1]"}},{"text":"]","clickEvent":{"action":"run_command","value":"/tp @p @e[tag=sr_SpawnMarker,scores={sr_player=2},limit=1]"}},{"text":" : "},{"score":{"name":"@a[scores={sr_player=2}]","objective":"sr_posx"}},{"text":" "},{"score":{"name":"@a[scores={sr_player=2}]","objective":"sr_posy"}},{"text":" "},{"score":{"name":"@a[scores={sr_player=2}]","objective":"sr_posz"}},{"text":"\n"},{"text":"[","clickEvent":{"action":"run_command","value":"/tp @p @e[tag=sr_SpawnMarker,scores={sr_player=3},limit=1]"}},{"selector":"@a[scores={sr_player=3}]","clickEvent":{"action":"run_command","value":"/tp @p @e[tag=sr_SpawnMarker,scores={sr_player=3},limit=1]"}},{"text":"]","clickEvent":{"action":"run_command","value":"/tp @p @e[tag=sr_SpawnMarker,scores={sr_player=3},limit=1]"}},{"text":" : "},{"score":{"name":"@a[scores={sr_player=3}]","objective":"sr_posx"}},{"text":" "},{"score":{"name":"@a[scores={sr_player=3}]","objective":"sr_posy"}},{"text":" "},{"score":{"name":"@a[scores={sr_player=3}]","objective":"sr_posz"}},{"text":"\n"},{"text":"[","clickEvent":{"action":"run_command","value":"/tp @p @e[tag=sr_SpawnMarker,scores={sr_player=4},limit=1]"}},{"selector":"@a[scores={sr_player=4}]","clickEvent":{"action":"run_command","value":"/tp @p @e[tag=sr_SpawnMarker,scores={sr_player=4},limit=1]"}},{"text":"]","clickEvent":{"action":"run_command","value":"/tp @p @e[tag=sr_SpawnMarker,scores={sr_player=4},limit=1]"}},{"text":" : "},{"score":{"name":"@a[scores={sr_player=4}]","objective":"sr_posx"}},{"text":" "},{"score":{"name":"@a[scores={sr_player=4}]","objective":"sr_posy"}},{"text":" "},{"score":{"name":"@a[scores={sr_player=4}]","objective":"sr_posz"}},{"text":"\n"},{"text":"[","clickEvent":{"action":"run_command","value":"/tp @p @e[tag=sr_SpawnMarker,scores={sr_player=5},limit=1]"}},{"selector":"@a[scpres={sr_player=5}]","clickEvent":{"action":"run_command","value":"/tp @p @e[tag=sr_SpawnMarker,scores={sr_player=5},limit=1]"}},{"text":"]","clickEvent":{"action":"run_command","value":"/tp @p @e[tag=sr_SpawnMarker,scores={sr_player=5},limit=1]"}},{"text":" : "},{"score":{"name":"@a[scores={sr_player=5}]","objective":"sr_posx"}},{"text":" "},{"score":{"name":"@a[scores={sr_player=5}]","objective":"sr_posy"}},{"text":" "},{"score":{"name":"@a[scores={sr_player=5}]","objective":"sr_posz"}},{"text":"\n"},{"text":"[","clickEvent":{"action":"run_command","value":"/tp @p @e[tag=sr_SpawnMarker,scores={sr_player=6},limit=1]"}},{"selector":"@a[scores={sr_player=6}]","clickEvent":{"action":"run_command","value":"/tp @p @e[tag=sr_SpawnMarker,scores={sr_player=6},limit=1]"}},{"text":"]","clickEvent":{"action":"run_command","value":"/tp @p @e[tag=sr_SpawnMarker,scores={sr_player=6},limit=1]"}},{"text":" : "},{"score":{"name":"@a[scores={sr_player=6}]","objective":"sr_posx"}},{"text":" "},{"score":{"name":"@a[scores={sr_player=6}]","objective":"sr_posy"}},{"text":" "},{"score":{"name":"@a[scores={sr_player=6}]","objective":"sr_posz"}},{"text":"\n"},{"text":"[","clickEvent":{"action":"run_command","value":"/tp @p @e[tag=sr_SpawnMarker,scores={sr_player=7},limit=1]"}},{"selector":"@a[scores={sr_player=7}]","clickEvent":{"action":"run_command","value":"/tp @p @e[tag=sr_SpawnMarker,scores={sr_player=7},limit=1]"}},{"text":"]","clickEvent":{"action":"run_command","value":"/tp @p @e[tag=sr_SpawnMarker,scores={sr_player=7},limit=1]"}},{"text":" : "},{"score":{"name":"@a[scores={sr_player=7}]","objective":"sr_posx"}},{"text":" "},{"score":{"name":"@a[scores={sr_player=7}]","objective":"sr_posy"}},{"text":" "},{"score":{"name":"@a[scores={sr_player=7}]","objective":"sr_posz"}},{"text":"\n"},{"text":"[","clickEvent":{"action":"run_command","value":"/tp @p @e[tag=sr_SpawnMarker,scores={sr_player=8},limit=1]"}},{"selector":"@a[scores={sr_player=8}]","clickEvent":{"action":"run_command","value":"/tp @p @e[tag=sr_SpawnMarker,scores={sr_player=8},limit=1]"}},{"text":"]","clickEvent":{"action":"run_command","value":"/tp @p @e[tag=sr_SpawnMarker,scores={sr_player=8},limit=1]"}},{"text":" : "},{"score":{"name":"@a[scores={sr_player=8}]","objective":"sr_posx"}},{"text":" "},{"score":{"name":"@a[scores={sr_player=8}]","objective":"sr_posy"}},{"text":" "},{"score":{"name":"@a[scores={sr_player=8}]","objective":"sr_posz"}},{"text":"\n"},{"text":"[","clickEvent":{"action":"run_command","value":"/tp @p @e[tag=sr_SpawnMarker,scores={sr_player=9},limit=1]"}},{"selector":"@a[scores={sr_player=9}]","clickEvent":{"action":"run_command","value":"/tp @p @e[tag=sr_SpawnMarker,scores={sr_player=9},limit=1]"}},{"text":"]","clickEvent":{"action":"run_command","value":"/tp @p @e[tag=sr_SpawnMarker,scores={sr_player=9},limit=1]"}},{"text":" : "},{"score":{"name":"@a[scores={sr_player=9}]","objective":"sr_posx"}},{"text":" "},{"score":{"name":"@a[scores={sr_player=9}]","objective":"sr_posy"}},{"text":" "},{"score":{"name":"@a[scores={sr_player=9}]","objective":"sr_posz"}},{"text":"\n"},{"text":"[","clickEvent":{"action":"run_command","value":"/tp @p @e[tag=sr_SpawnMarker,scores={sr_player=10},limit=1]"}},{"selector":"@a[scores={sr_player=10}]","clickEvent":{"action":"run_command","value":"/tp @p @e[tag=sr_SpawnMarker,scores={sr_player=10},limit=1]"}},{"text":"]","clickEvent":{"action":"run_command","value":"/tp @p @e[tag=sr_SpawnMarker,scores={sr_player=10},limit=1]"}},{"text":" : "},{"score":{"name":"@a[scores={sr_player=10}]","objective":"sr_posx"}},{"text":" "},{"score":{"name":"@a[scores={sr_player=10}]","objective":"sr_posy"}},{"text":" "},{"score":{"name":"@a[scores={sr_player=10}]","objective":"sr_posz"}},{"text":"\n"},{"text":"[","clickEvent":{"action":"run_command","value":"/tp @p @e[tag=sr_SpawnMarker,scores={sr_player=11},limit=1]"}},{"selector":"@a[scores={sr_player=11}]","clickEvent":{"action":"run_command","value":"/tp @p @e[tag=sr_SpawnMarker,scores={sr_player=11},limit=1]"}},{"text":"]","clickEvent":{"action":"run_command","value":"/tp @p @e[tag=sr_SpawnMarker,scores={sr_player=11},limit=1]"}},{"text":" : "},{"score":{"name":"@a[scores={sr_player=11}]","objective":"sr_posx"}},{"text":" "},{"score":{"name":"@a[scores={sr_player=11}]","objective":"sr_posy"}},{"text":" "},{"score":{"name":"@a[scores={sr_player=11}]","objective":"sr_posz"}},{"text":"\n"},{"text":"[","clickEvent":{"action":"run_command","value":"/tp @p @e[tag=sr_SpawnMarker,scores={sr_player=12},limit=1]"}},{"selector":"@a[scores={sr_player=12}]","clickEvent":{"action":"run_command","value":"/tp @p @e[tag=sr_SpawnMarker,scores={sr_player=12},limit=1]"}},{"text":"]","clickEvent":{"action":"run_command","value":"/tp @p @e[tag=sr_SpawnMarker,scores={sr_player=12},limit=1]"}},{"text":" : "},{"score":{"name":"@a[scores={sr_player=12}]","objective":"sr_posx"}},{"text":" "},{"score":{"name":"@a[scores={sr_player=12}]","objective":"sr_posy"}},{"text":" "},{"score":{"name":"@a[scores={sr_player=12}]","objective":"sr_posz"}},{"text":"\n"},{"text":"[","clickEvent":{"action":"run_command","value":"/tp @p @e[tag=sr_SpawnMarker,scores={sr_player=13},limit=1]"}},{"selector":"@a[scores={sr_player=13}]","clickEvent":{"action":"run_command","value":"/tp @p @e[tag=sr_SpawnMarker,scores={sr_player=13},limit=1]"}},{"text":"]","clickEvent":{"action":"run_command","value":"/tp @p @e[tag=sr_SpawnMarker,scores={sr_player=13},limit=1]"}},{"text":" : "},{"score":{"name":"@a[scores={sr_player=13}]","objective":"sr_posx"}},{"text":" "},{"score":{"name":"@a[scores={sr_player=13}]","objective":"sr_posy"}},{"text":" "},{"score":{"name":"@a[scores={sr_player=13}]","objective":"sr_posz"}},{"text":"\n"},{"text":"[","clickEvent":{"action":"run_command","value":"/tp @p @e[tag=sr_SpawnMarker,scores={sr_player=14},limit=1]"}},{"selector":"@a[scores={sr_player=14}]","clickEvent":{"action":"run_command","value":"/tp @p @e[tag=sr_SpawnMarker,scores={sr_player=14},limit=1]"}},{"text":"]","clickEvent":{"action":"run_command","value":"/tp @p @e[tag=sr_SpawnMarker,scores={sr_player=14},limit=1]"}},{"text":" : "},{"score":{"name":"@a[scores={sr_player=14}]","objective":"sr_posx"}},{"text":" "},{"score":{"name":"@a[scores={sr_player=14}]","objective":"sr_posy"}},{"text":" "},{"score":{"name":"@a[scores={sr_player=14}]","objective":"sr_posz"}},{"text":"\n"},{"text":"[","clickEvent":{"action":"run_command","value":"/tp @p @e[tag=sr_SpawnMarker,scores={sr_player=15},limit=1]"}},{"selector":"@a[scores={sr_player=15}]","clickEvent":{"action":"run_command","value":"/tp @p @e[tag=sr_SpawnMarker,scores={sr_player=15},limit=1]"}},{"text":"]","clickEvent":{"action":"run_command","value":"/tp @p @e[tag=sr_SpawnMarker,scores={sr_player=15},limit=1]"}},{"text":" : "},{"score":{"name":"@a[scores={sr_player=15}]","objective":"sr_posx"}},{"text":" "},{"score":{"name":"@a[scores={sr_player=15}]","objective":"sr_posy"}},{"text":" "},{"score":{"name":"@a[scores={sr_player=15}]","objective":"sr_posz"}},{"text":"\n"},{"text":"[","clickEvent":{"action":"run_command","value":"/tp @p @e[tag=sr_SpawnMarker,scores={sr_player=16},limit=1]"}},{"selector":"@a[scores={sr_player=16}]","clickEvent":{"action":"run_command","value":"/tp @p @e[tag=sr_SpawnMarker,scores={sr_player=16},limit=1]"}},{"text":"]","clickEvent":{"action":"run_command","value":"/tp @p @e[tag=sr_SpawnMarker,scores={sr_player=16},limit=1]"}},{"text":" : "},{"score":{"name":"@a[scores={sr_player=16}]","objective":"sr_posx"}},{"text":" "},{"score":{"name":"@a[scores={sr_player=16}]","objective":"sr_posy"}},{"text":" "},{"score":{"name":"@a[scores={sr_player=16}]","objective":"sr_posz"}}]
execute if entity @e[tag=sr_MapCenter,scores={sr_ingame=1}] run execute at @a[tag=sr_upper_temp] run tag @p add sr_upper
execute if entity @e[tag=sr_MapCenter,scores={sr_ingame=1}] run tag @a[tag=sr_upper_temp] remove sr_upper_temp
execute if entity @e[tag=sr_MapCenter,scores={sr_ingame=1}] run execute at @a[tag=sr_observer,tag=sr_upper,x_rotation=-85..] run tag @p remove sr_upper

execute if entity @e[tag=sr_MapCenter,scores={sr_ingame=1}] run tag @a[tag=!sr_now_player] add sr_observer
execute if entity @e[tag=sr_MapCenter,scores={sr_ingame=1}] run gamemode spectator @a[tag=!sr_now_player]
